<div class="game-container factory-bg">
  <header class="game-header">
    <h1>ğŸ® Connect Four</h1>
    <div class="game-stats">
      <div class="stat">
        <label>Tempo de Jogo</label>
        <span class="value">â± {{ getGameTimeFormatted() }}</span>
      </div>
      <div class="stat">
        <label>Status</label>
        <span class="value" [class.my-turn]="timerInfo.isMyTurn">
          {{ getCurrentPlayerDisplay() }}
        </span>
      </div>
    </div>
  </header>

  <div class="stage">
    <!-- EstaÃ§Ã£o Esquerda -->
    <div class="station station-left">
      <img class="conveyor" src="../../../asstes/pixels/cart.png" alt="Esteira" />
      <div class="crane">
        <img class="crane-pole" src="../../../asstes/pixels/claw_gray_pole.png" alt="Suporte" />
        <img class="crane-head" src="../../../asstes/pixels/claw_gray_1.png" alt="Garra" />
      </div>
      <div class="digital-display">
        <img src="../../../asstes/pixels/tela_digital.png" alt="Display" />
        <span class="digits">{{ (timerInfo.isMyTurn && gameState.myPlayer === 1) ? (timerInfo.myTimeLeft | number:'2.0-0') + 's' : '00:00' }}</span>
      </div>
    </div>

    <!-- Centro: Tabuleiro -->
    <div class="center-board">
      <img class="board-frame" src="../../../asstes/pixels/tabuleiro.png" alt="Tabuleiro" />

      <!-- Controles de coluna alinhados ao topo do tabuleiro -->
      <div class="column-controls">
        <button
          *ngFor="let col of [0,1,2,3,4,5,6]"
          (click)="dropBox(col)"
          [ngClass]="getColumnButtonClass(col)"
          [disabled]="!timerInfo.isMyTurn || gameState.gameOver || isColumnBlocked(col)"
        >â¬‡</button>
      </div>

      <!-- Grid e peÃ§as -->
      <div class="game-grid">
        <div
          *ngFor="let box of boxes"
          class="box"
          [style.left.px]="box.col * 64"
          [style.top.px]="box.row * 64"
          [style.backgroundColor]="getPlayerColorHex(box.player)"
        ></div>
        <div class="grid-lines">
          <div *ngFor="let i of [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]" class="grid-cell"></div>
        </div>
      </div>

      <!-- Base com caixas -->
      <div class="board-base">
        <img src="../../../asstes/pixels/metal_caixa.png" alt="Caixa" />
        <img src="../../../asstes/pixels/metal_caixa.png" alt="Caixa" />
      </div>

      <!-- Display central -->
      <div class="digital-display center-display">
        <img src="../../../asstes/pixels/tela_digital.png" alt="Display" />
        <span class="digits">{{ getGameTimeFormatted() }}</span>
      </div>
    </div>

    <!-- EstaÃ§Ã£o Direita -->
    <div class="station station-right">
      <img class="conveyor" src="../../../asstes/pixels/cart.png" alt="Esteira" />
      <div class="crane">
        <img class="crane-pole" src="../../../asstes/pixels/claw_gray_pole.png" alt="Suporte" />
        <img class="crane-head" src="../../../asstes/pixels/claw_gray_1.png" alt="Garra" />
      </div>
      <div class="digital-display">
        <img src="../../../asstes/pixels/tela_digital.png" alt="Display" />
        <span class="digits">{{ (timerInfo.isMyTurn && gameState.myPlayer === 2) ? (timerInfo.myTimeLeft | number:'2.0-0') + 's' : '00:00' }}</span>
      </div>
    </div>
  </div>

  <div class="turn-timer-section" [class.my-turn]="timerInfo.isMyTurn">
    <div class="timer-container">
      <div class="timer-label">â± Tempo do Turno</div>
      <div class="timer-display">
        <div class="timer-bar"><div class="timer-fill" [style.width.%]="getTimePercentage()"></div></div>
        <div class="timer-text">{{ timerInfo.myTimeLeft }}s</div>
      </div>
    </div>
  </div>

  <div class="powers-section">
    <h3>âš¡ Poderes</h3>
    <div class="power-buttons" [class.disabled]="timerInfo.isMyTurn">
      <button (click)="usePower('clear_bottom_line')" class="btn-power" [disabled]="timerInfo.isMyTurn || gameState.gameOver">ğŸ§¹ Limpar Linha Inferior</button>
      <button (click)="usePower('eliminate_box')" class="btn-power" [disabled]="timerInfo.isMyTurn || gameState.gameOver">ğŸ’¥ Eliminar Caixa</button>
      <button (click)="usePower('reduce_opponent_time')" class="btn-power" [disabled]="timerInfo.isMyTurn || gameState.gameOver">â° Reduzir Tempo</button>
      <button (click)="usePower('block_column', { col: 0 })" class="btn-power" [disabled]="timerInfo.isMyTurn || gameState.gameOver">ğŸš« Bloquear Coluna</button>
    </div>
  </div>

  <div *ngIf="gameState.gameOver" class="game-over-modal">
    <div class="modal-content">
      <h2 *ngIf="gameState.winner === 'tie'" class="tie-message">ğŸ¤ Jogo Empatou!</h2>
      <h2 *ngIf="gameState.winner === gameState.myId" class="win-message">ğŸ‰ VocÃª Ganhou!</h2>
      <h2 *ngIf="gameState.winner !== 'tie' && gameState.winner !== gameState.myId" class="lose-message">ğŸ˜¢ VocÃª Perdeu</h2>
      <div class="modal-buttons">
        <button class="btn-action" (click)="navigateToLobby()">Voltar ao Lobby</button>
      </div>
    </div>
  </div>
</div>
