<div class="game-container">
  <audio id="bg" src="/svgs/background.mp3" autoplay loop></audio> 
  <!-- HEADER -->
  <header class="game-header">
    <h1>ğŸ® Empilha Caixote - Em Jogo</h1>
    <div class="game-stats">
      <div class="stat">
        <label>Tempo de Jogo</label>
        <span class="value">â± {{ getGameTimeFormatted() }}</span>
      </div>
      <div class="stat">
        <label>Status</label>
        <span class="value" [class.my-turn]="timerInfo.isMyTurn">
          {{ getCurrentPlayerDisplay() }}
        </span>
      </div>
    </div>
  </header>

  <audio id="bg" src="../../../asstes/sons/background.mp3" autoplay loop></audio>  
  <!-- LAYOUT EM LINHA: PODERES - GRID - PODERES -->
  <div class="game-split">
    <div class="player-panel left">
      <h3>âš¡ Poderes - {{ getPlayers()[0]?.username || 'Jogador 1' }}</h3>
      <div class="power-buttons">
        <button
          class="btn-power"
          (click)="usePlayerPower(0, 'clear_bottom_line')"
          [disabled]="!canUsePower(0, 'clear_bottom_line')"
        >
          ğŸ§¹ Limpar Linha Inferior
        </button>
        <button
          class="btn-power"
          (click)="usePlayerPower(0, 'eliminate_box')"
          [disabled]="!canUsePower(0, 'eliminate_box')"
        >
          ğŸ’¥ Eliminar Caixa
        </button>
        <button
          class="btn-power"
          (click)="usePlayerPower(0, 'reduce_opponent_time')"
          [disabled]="!canUsePower(0, 'reduce_opponent_time')"
        >
          â° Reduzir Tempo
        </button>
        <button
          class="btn-power"
          (click)="usePlayerPower(0, 'block_column', { col: 0 })"
          [disabled]="!canUsePower(0, 'block_column')"
        >
          ğŸš« Bloquear Coluna
        </button>
      </div>
    </div>

    <div class="board-panel">
      <div class="column-controls">
        <button
          *ngFor="let col of [0, 1, 2, 3, 4, 5, 6]"
          (click)="dropBox(col)"
          [ngClass]="getColumnButtonClass(col)"
          [disabled]="
            !timerInfo.isMyTurn || gameState.gameOver || isColumnBlocked(col)
          "
        >
          â¬‡
        </button>
      </div>
      <div class="game-grid-wrapper">
        <div class="game-grid">
          <div
            *ngFor="let box of boxes"
            class="box"
            [style.left.px]="box.col * 64"
            [style.top.px]="box.row * 64"
            [style.backgroundColor]="getPlayerColorHex(box.player)"
          ></div>
          <div class="grid-lines">
            <div
              *ngFor="
                let i of [
                  0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,
                  18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,
                  34, 35, 36, 37, 38, 39, 40, 41
                ]
              "
              class="grid-cell"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <div class="player-panel right">
      <h3>âš¡ Poderes - {{ getPlayers()[1]?.username || 'Jogador 2' }}</h3>
      <div class="power-buttons">
        <button
          class="btn-power"
          (click)="usePlayerPower(1, 'clear_bottom_line')"
          [disabled]="!canUsePower(1, 'clear_bottom_line')"
        >
          ğŸ§¹ Limpar Linha Inferior
        </button>
        <button
          class="btn-power"
          (click)="usePlayerPower(1, 'eliminate_box')"
          [disabled]="!canUsePower(1, 'eliminate_box')"
        >
          ğŸ’¥ Eliminar Caixa
        </button>
        <button
          class="btn-power"
          (click)="usePlayerPower(1, 'reduce_opponent_time')"
          [disabled]="!canUsePower(1, 'reduce_opponent_time')"
        >
          â° Reduzir Tempo
        </button>
        <button
          class="btn-power"
          (click)="usePlayerPower(1, 'block_column', { col: 0 })"
          [disabled]="!canUsePower(1, 'block_column')"
        >
          ğŸš« Bloquear Coluna
        </button>
      </div>
    </div>
  </div>

  <!-- TIMER DO TURNO -->
  <div class="turn-timer-section" [class.my-turn]="timerInfo.isMyTurn">
    <div class="timer-container">
      <div class="timer-label">â± Tempo do Turno</div>
      <div class="timer-display">
        <div class="timer-bar">
          <div class="timer-fill" [style.width.%]="getTimePercentage()"></div>
        </div>
        <div class="timer-text">{{ timerInfo.myTimeLeft }}s</div>
      </div>
    </div>
  </div>


  <!-- STATUS DO JOGO -->
  <div *ngIf="gameState.gameOver" class="game-over-modal">
    <div class="modal-content">
      <h2 *ngIf="gameState.winner === 'tie'" class="tie-message">
        ğŸ¤ Jogo Empatou!
      </h2>
      <h2 *ngIf="gameState.winner === gameState.myId" class="win-message">
        ğŸ‰ VocÃª Ganhou!
      </h2>
      <h2
        *ngIf="
          gameState.winner !== 'tie' && gameState.winner !== gameState.myId
        "
        class="lose-message"
      >
        ğŸ˜¢ VocÃª Perdeu
      </h2>
      <div class="modal-buttons">
        <button class="btn-action" (click)="navigateToLobby()">
          Voltar ao Lobby
        </button>
      </div>
    </div>
  </div>
</div>
